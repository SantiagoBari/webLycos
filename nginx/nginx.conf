# Este es el bloque de servidor principal para el tráfico HTTP (puerto 80).
# Es el único bloque activo para tu red local.
server {
    listen 80;
    # Usar '_' para aceptar cualquier nombre de host o IP en la red local
    server_name _; 

    # COMIENZO DE CONFIGURACIÓN HTTP

    # Regla 1: Proxy Inverso para el Backend (API Flask)
    # Redirige todo el tráfico que comienza con /api/ al contenedor backend
    location /api/ {
        # 'backend' es el nombre del servicio Docker Compose y su puerto interno (8000)
        proxy_pass http://backend:8000;
        
        # Cabeceras estándar para un proxy (permiten al backend saber la IP real del cliente)
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Regla 2: Proxy Inverso para el Frontend (Next.js)
    # Redirige todo el tráfico restante (la web) al contenedor frontend
    location / {
        # 'frontend' es el nombre del servicio Docker Compose y su puerto interno (3000)
        proxy_pass http://frontend:3000;
        
        # Cabeceras estándar para el proxy
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # FIN DE CONFIGURACIÓN HTTP
}


# =========================================================================
# === BLOQUES DE CONFIGURACIÓN HTTPS/SSL (Comentados para Entorno Local) ===
# =========================================================================

# server {
#     # Bloque de Redirección: Escucha el tráfico HTTP y lo redirige forzosamente a HTTPS
#     listen 80;
#     server_name lykos.com www.lykos.com.ar;
#
#     # Esta directiva redirige TODAS las peticiones HTTP a HTTPS (código 301 - permanente)
#     # return 301 https://$host$request_uri;
# }
#
# server {
#     # Bloque HTTPS: Escucha el tráfico seguro en el puerto 443
#     listen 443 ssl;
#     server_name lykos.com www.lykos.com; # Reemplaza con tu dominio
#
#     # Directorios a los Certificados SSL (Generados por Certbot)
#     # ssl_certificate /etc/letsencrypt/live/lykos.com/fullchain.pem;
#     # ssl_certificate_key /etc/letsencrypt/live/lykos.com/privkey.pem;
#
#     # Configuración de Seguridad Básica (Opcional, pero recomendada)
#     # ssl_protocols TLSv1.2 TLSv1.3;
#     # ssl_ciphers HIGH:!aNULL:!MD5;
#
#     # Las reglas de proxy (location) son las mismas, pero ahora son seguras:
#     #
#     # location /api/ {
#     #     proxy_pass http://backend:8000;
#     #     proxy_set_header Host $host;
#     #     proxy_set_header X-Real-IP $remote_addr;
#     #     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#     #     proxy_set_header X-Forwarded-Proto $scheme;
#     # }
#     #
#     # location / {
#     #     proxy_pass http://frontend:3000;
#     #     proxy_set_header Host $host;
#     #     proxy_set_header X-Real-IP $remote_addr;
#     #     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#     # }
# }
